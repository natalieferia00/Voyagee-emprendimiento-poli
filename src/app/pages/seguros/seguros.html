<div class="card shadow-1 border-none bg-white">
    <div class="flex flex-column md:flex-row justify-content-between align-items-start md:align-items-center mb-5 gap-3">
        <div>
            <h2 class="m-0 text-xl font-bold text-900">Documentación y Otros Gastos</h2>
            <p class="text-600 m-0 text-sm">
                Control administrativo independiente. <b>Nota:</b> Para que estos costos afecten su presupuesto global, 
                debe ingresarlos <u>manualmente</u> como un gasto en el <b>Centro de Control Presupuestario/presupuesto</b>.
            </p>
        </div>
        <p-button 
            label="Nuevo Registro" 
            icon="pi pi-plus" 
            (click)="abrirModal()" 
            severity="success">
        </p-button>
    </div>

    <p-table 
        [value]="documentos()" 
        [scrollable]="true" 
        scrollHeight="450px" 
        styleClass="p-datatable-sm p-datatable-gridlines"
        [tableStyle]="{'width': '100%'}">
        
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 50px" class="text-center">Pago</th>
                <th class="font-bold">Descripción</th>
                <th>Entidad</th>
                <th style="width: 60px" class="text-center">Notas</th>
                <th style="width: 60px" class="text-center">URL</th>
                <th style="width: 120px" class="text-center">Estado</th>
                <th style="width: 80px" class="text-center">Acción</th>
                <th style="width: 150px" class="text-right font-bold">Costo (COP)</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-doc>
            <tr class="text-sm">
                <td class="text-center">
                    <p-checkbox [(ngModel)]="doc.reservadoComprado" [binary]="true" (onChange)="toggleEstado()"></p-checkbox>
                </td>
                <td class="font-medium text-900">{{ doc.nombre }}</td>
                <td class="text-600">{{ doc.entidad }}</td>
                <td class="text-center">
                    <p-button *ngIf="doc.descripcion" icon="pi pi-eye" [text]="true" severity="secondary" [pTooltip]="doc.descripcion"></p-button>
                </td>
                <td class="text-center">
                    <a *ngIf="doc.url" [href]="doc.url" target="_blank">
                        <p-button icon="pi pi-link" [text]="true" severity="info"></p-button>
                    </a>
                </td>
                <td class="text-center">
                    <span 
                        class="px-2 py-1 border-round text-xs font-bold border-1"
                        [ngClass]="doc.reservadoComprado ? 'bg-green-100 text-green-700 border-green-200' : 'bg-gray-100 text-gray-700 border-gray-200'">
                        {{ doc.reservadoComprado ? 'PAGADO' : 'PENDIENTE' }}
                    </span>
                </td>
                <td class="text-center">
                    <p-button icon="pi pi-trash" [text]="true" severity="danger" (click)="eliminar(doc.id)"></p-button>
                </td>
                <td class="text-right" [ngClass]="{'text-green-700 font-bold': doc.reservadoComprado}">
                    {{ formatCurrency(doc.costo) }}
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="displayModal" header="Detalles del Registro" [modal]="true" [style]="{width: '480px'}" styleClass="p-fluid" [draggable]="false" [resizable]="false">
    <div class="py-3">
        <div class="field grid mb-4">
            <label class="col-12 md:col-4 font-semibold text-800">Descripción</label>
            <div class="col-12 md:col-8">
                <input pInputText [(ngModel)]="nuevoDoc.nombre" placeholder="Ej. Pasaporte" class="p-inputtext-lg" />
            </div>
        </div>

        <div class="field grid mb-4">
            <label class="col-12 md:col-4 font-semibold text-800">Entidad</label>
            <div class="col-12 md:col-8">
                <input pInputText [(ngModel)]="nuevoDoc.entidad" placeholder="Ej. Cancillería" class="p-inputtext-lg" />
            </div>
        </div>

        <div class="field grid mb-4">
            <label class="col-12 md:col-4 font-semibold text-800">URL Enlace</label>
            <div class="col-12 md:col-8">
                <input pInputText [(ngModel)]="nuevoDoc.url" placeholder="https://..." class="p-inputtext-lg" />
            </div>
        </div>

        <div class="field grid mb-4">
            <label class="col-12 md:col-4 font-semibold text-800">Notas</label>
            <div class="col-12 md:col-8">
                <textarea pInputTextarea [(ngModel)]="nuevoDoc.descripcion" rows="2" placeholder="Detalles..." class="p-inputtext-lg"></textarea>
            </div>
        </div>

        <div class="field grid mb-4">
            <label class="col-12 md:col-4 font-semibold text-800">Costo (COP)</label>
            <div class="col-12 md:col-8">
                <p-inputNumber [(ngModel)]="nuevoDoc.costo" mode="currency" currency="COP" locale="es-CO" styleClass="p-inputtext-lg"></p-inputNumber>
            </div>
        </div>

        <div class="field grid mb-2">
            <label class="col-12 md:col-4 font-semibold text-800">Estado</label>
            <div class="col-12 md:col-8 flex align-items-center">
                <p-checkbox [(ngModel)]="nuevoDoc.reservadoComprado" [binary]="true" id="is_paid"></p-checkbox>
                <label for="is_paid" class="ml-2 text-700 cursor-pointer text-sm">Marcar como pagado</label>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex gap-2 justify-content-end pb-2">
            <p-button label="Cancelar" [text]="true" severity="secondary" (click)="displayModal = false"></p-button>
            <p-button label="Guardar" (click)="guardar()" severity="success"></p-button>
        </div>
    </ng-template>
</p-dialog>